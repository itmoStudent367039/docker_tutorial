# Docker

> В данном отчете рассмотрены основные принципы работы с докером: команды для создания и управления контейнерами, а
> также примеры использования для улучшения процесса разработки и доставки программного обеспечения.

## Файлы для конфигурации сборки проекта:

+ ***docker-compose:***
    + *Инструмент для объявления, конфигурации и запуска Docker контейнеров (Многоконтейнерные приложения)*
    + *Файл с расширением .yml*
    + *Конфигурация для контейнеров:*
        + ```services:``` - раздел, в котором определяются различные сервисы или контейнеры, которые составляют
          многоконтейнерное приложение
        + ```build:``` - путь к контексту сборки
        + ```image:``` - если не используется сборка через Dockerfile, можно указать готовый образ
        + ```ports:``` - определяет порты, которые будут проброшены из контейнера на хост-систему
        + ```environment:``` - задает переменные среды для сервиса
        + ```volumes:``` - определяет монтирование директорий или создание томов для контейнера

```yaml
    version: '3.8'

    services:
      frontend:
        build:
          context: ./frontend
          dockerfile: Dockerfile
        ports:
          - "3000:3000"
        environment:
          - NODE_ENV=production
        volumes:
          - ./frontend:/usr/src/app

      backend:
        build:
          context: ./backend
          dockerfile: Dockerfile
        command: java -jar app.jar
        ports:
          - "8080:8080"
        environment:
          - DB_HOST=db
        depends_on:
          - db
        volumes:
          - ./backend:/usr/src/app

      db:
        image: mysql:latest
        environment:
          - MYSQL_ROOT_PASSWORD=root
        ports:
          - "3306:3306"
        volumes:
          - dbdata:/var/lib/mysql
```

+ ***Dockerfile:***
    + *Docker создает образы автоматически, читая инструкции из Dockerfile, который представляет собой текстовый файл,
      содержащий все команды, необходимые для создания данного образа.*
    + *Формат:*
        + ```INSTRUCTION arguments```
    + *Пример инструкций:*
        + Dockerfile начинается с инструкции ```FROM [--platform=<platform>] <image> [AS <name>]```, которая указывает
          на родительский образ, из которого будет строится текущий
        + ```ENV env_name=value``` - устанавливает переменные среды внутри контейнера. Эти переменные доступны во время
          выполнения контейнера.
        + ```ARG arg_name=value``` - определяет переменные, которые могут быть переданы во время сборки образа через
          параметры командной строки
      ```dockerfile
      ARG VERSION=latest
      FROM busybox:$VERSION
      ARG VERSION
      ```
        + ```RUN``` - выполняет команды внутри контейнера при создании образа. Используется для установки пакетов,
          обновления системы и других операций.
        + ```CMD``` - задает команду или исполняемый файл, который будет запущен при запуске контейнера
        + ```WORKDIR``` - устанавливает рабочий каталог для всех последующих инструкций в Dockerfile
        + ```СOPY``` - копирует файлы и каталоги из исходной директории (на хост-системе) в файловую систему контейнера.
        + ```WORKDIR``` - устанавливает рабочий каталог для всех последующих инструкций в Dockerfile
        + ```EXPOSE``` - объявляет порты, которые контейнер будет слушать во время выполнения
        + ```ADD``` - похож на COPY, но обладает дополнительными возможностями, такими как автоматическое распаковывание
          файлов и загрузка файлов по URL.

```dockerfile
    FROM node:latest
    ARG APP_VERSION=1.0.0
    ENV NODE_ENV=production
    WORKDIR /usr/src/app
    COPY package*.json ./
    RUN npm install
    COPY . .
    EXPOSE 3000
    CMD ["npm", "start"]
```

## Терминология:

+ ***Docker Container:*** Запускаемые экземпляры образов. Они представляют собой среду, в которой исполняются
  приложения. Контейнер содержит все необходимое для запуска приложения: код, зависимости, среду выполнения и настройки.
  Они изолированы друг от друга и от хост-системы, что позволяет им работать в одной среде без конфликтов с другими
  контейнерами.


+ ***Docker Image:*** Шаблоны для создания контейнеров. Они содержат файловую систему, необходимые зависимости,
  настройки окружения и инструкции по тому, как запустить приложение. Образы являются неизменными и состоят из слоев (
  layers), что делает их легковесными и позволяет быстро создавать и развертывать контейнеры.


+ ***Docker Volume:*** Представляют собой персистентное хранилище данных, используемое контейнерами. Они позволяют
  сохранять данные между запусками контейнеров и обеспечивают доступ к данным из различных контейнеров. Volumes могут
  быть использованы для хранения баз данных, журналов, конфигурационных файлов и других данных, которые нужно сохранить
  и переносить между контейнерами.

## Как это работает:

+ ***Image:*** Создается разработчиком с помощью Dockerfile, который содержит инструкции для сборки образа. Этот образ
  размещается в Docker Registry, таком как Docker Hub.


+ ***Container:*** При запуске контейнера из образа Docker использует его как основу для создания изолированной среды
  выполнения. Контейнер запускается из образа и становится исполняемым экземпляром приложения.


+ ***Volume:*** При необходимости сохранения данных между запусками контейнеров или обмена данными между контейнерами,
  используются Docker Volumes, которые связываются с контейнерами для доступа к данным.

---

+ Когда вы создаете Docker образ, он состоит из слоев (layers) файловой системы. Каждая инструкция в Dockerfile создает
  новый слой в образе. Эти слои объединяются вместе для создания конечной файловой системы образа.


+ Каждый слой представляет собой изменения, внесенные новой инструкцией в Dockerfile. Например, если один слой добавляет
  файлы, другой слой устанавливает зависимости, а третий слой запускает определенную команду.


+ Преимущество этой системы состоит в том, что Docker использует кэширование этих слоев. Если какой-то слой образа не
  изменялся, он берется из кэша, что ускоряет процесс сборки образа.


+ Это также делает образы легкими и позволяет экономить место, поскольку различные образы могут использовать одни и те
  же слои.


+ При изменении какого-либо слоя в образе Docker не пересоздает его с нуля, а лишь изменяет или добавляет новый слой,
  что обеспечивает эффективность и скорость операций создания и обновления контейнеров.

---